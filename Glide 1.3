local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Create GUI
local player = Players.LocalPlayer
local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("ImageButton")
button.Parent = gui
button.Size = UDim2.new(0, 140, 0, 90)
button.Position = UDim2.new(0.6, 0, 0.5, 0)
button.Image = "rbxassetid://107366938518954"
button.BackgroundTransparency = 1

local function applySlowFalling()
    if not button.Visible then return end -- Prevent activation during cooldown
    button.Visible = false -- Hide button for cooldown
    
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoid and rootPart and humanoid:GetState() == Enum.HumanoidStateType.Freefall then
            humanoid:SetAttribute("SlowFalling", true)
            
            -- Reduce gravity effect
            local startTime = tick()
            local connection
            connection = RunService.Heartbeat:Connect(function()
                if humanoid:GetAttribute("SlowFalling") then
                    local elapsedTime = tick() - startTime
                    local fallSpeed = elapsedTime > 5 and -12 or -3 -- Increase fall speed after 5 seconds
                    rootPart.Velocity = Vector3.new(rootPart.Velocity.X, math.max(rootPart.Velocity.Y, fallSpeed), rootPart.Velocity.Z)
                else
                    connection:Disconnect()
                end
            end)
            
            -- Play initial animation
            local animator = humanoid:FindFirstChildOfClass("Animator")
            if animator then
                local animation = Instance.new("Animation")
                animation.AnimationId = "rbxassetid://104077515216832"
                local animTrack = animator:LoadAnimation(animation)
                animTrack:Play()
                
                local newAnimTrack
                -- Change animation after 5 seconds
                local animationConnection
                animationConnection = RunService.Heartbeat:Connect(function()
                    if humanoid:GetAttribute("SlowFalling") and tick() - startTime > 5 then
                        animTrack:Stop()
                        local newAnimation = Instance.new("Animation")
                        newAnimation.AnimationId = "rbxassetid://136705072136812"
                        newAnimTrack = animator:LoadAnimation(newAnimation)
                        newAnimTrack:Play()
                        animationConnection:Disconnect()
                    end
                end)
                
                -- Stop when player lands
                local stateConnection
                stateConnection = humanoid.StateChanged:Connect(function(_, newState)
                    if newState == Enum.HumanoidStateType.Landed then
                        humanoid:SetAttribute("SlowFalling", false)
                        animTrack:Stop()
                        if newAnimTrack then
                            newAnimTrack:Stop()
                        end
                        stateConnection:Disconnect()
                    end
                end)
            end
        end
    end
    
    -- Cooldown timer
    task.delay(15, function()
        button.Visible = true
    end)
end

-- Button click event
button.MouseButton1Click:Connect(applySlowFalling)
